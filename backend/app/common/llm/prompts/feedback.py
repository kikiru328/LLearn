FEEDBACK_GENERATION_PROMPT = """
당신의 임무: 학습자 요약을 분석하여 아래 JSON 스키마에 맞춘 정량/정성 피드백을 생성한다. 오직 JSON만 출력한다.

[입력]
- lessons: {{lessons}}
- summary: {{summary}}

[출력 형식(JSON only)]
{{
  "cognitive_load_retention": <float, 0.0~10.0, 소수점 1자리>,
  "engagement_behavior": <float, 0.0~10.0, 소수점 1자리>,
  "transfer_application": <float, 0.0~10.0, 소수점 1자리>,
  "competency_performance": <float, 0.0~10.0, 소수점 1자리>,
  "realtime_analytics": <float, 0.0~10.0, 소수점 1자리>,
  "score": <위 5개 평균, 소수점 1자리>,
  "comment": "<아래 작문 규칙에 따른 Markdown 한국어 텍스트, 개행은 \\n 사용>"
}}

[점수 규칙]
- 각 점수는 0.0~10.0, 소수점 1자리.
- "score" = (5개 항목 평균), 반올림하여 소수점 1자리.
- 기본 평가는 5.0~7.0 범위.
- 특별히 우수한 부분만 8.0 이상 허용.
- 부족하거나 빠진 부분이 뚜렷하면 5.0 이하도 가능.

[comment 작문 규칙]
- 시작 문장: "{{lessons}}"에 대한 요약을 바탕으로 개인화 피드백을 제공합니다.
- 반드시 {{summary}}에서 **직접 인용 2개 이상** 포함(따옴표로 표기, 각 6~15단어).
- Markdown 문법을 사용하여 구조화: 
  - 큰 제목(##), 작은 제목(###), bullet(-) 사용 가능.
- "세부 피드백" 섹션에 5개 항목을 각각 2~3문장으로 구체 평가:
  - 🧠 핵심 내용 이해도 (cognitive_load_retention/10)
  - 🎯 학습 참여도 (engagement_behavior/10)
  - 🔄 적용 능력 (transfer_application/10)
  - 📝 표현 및 구성 능력 (competency_performance/10)
  - 🔍 종합 분석 능력 (realtime_analytics/10)
- "학습 보완 점"과 "다음 단계 학습 계획"은 Markdown 하위 섹션으로 작성하고, bullet(-)을 활용하여 2~4개 제시.
- 모호어(예: “전반적으로 좋음”) 금지. **구체 근거**를 {{summary}} 내용에서 끌어올 것.
- 대괄호로 된 지시문/placeholder(예: [구체적 부분]) 절대 사용 금지.
- 코드블록, 불필요한 마크다운 문법(표 등) 금지.
- comment의 모든 인용은 {{summary}} 원문에서 그대로 가져온다(오탈자 수정 금지).
- summary에 없는 정보(토론, 질문, 예시, 감정평가 등)는 절대 서술하지 않는다.
- summary가 단순 나열뿐이면, 그 나열을 인용하고 '설명이 부족함'을 명시적으로 지적한다.

[품질/일관성 규칙]
- comment 길이: 700~1200자.
- 인용은 과도하게 길게 넣지 말고 요점을 드러낼 것.
- lessons의 각 주제를 최소 1회 이상 명시적으로 언급하고, summary에서 해당 주제가 다뤄진 흔적을 근거로 연결.

[출력 전 자가검증]
1) JSON 외 텍스트가 있는가? → 있으면 제거 후 재작성.
2) comment에 대괄호 []나 '각 주제', '구체적 부분' 등의 placeholder 표현이 남았는가? → 있으면 구체 문장으로 바꿔 재작성.
3) 인용 2개 이상 포함했는가? 각 6~15단어인가? → 아니면 보완.
4) score가 5개 항목의 평균(소수점 1자리 반올림)과 일치하는가? → 아니면 수정.
5) 모든 점수가 0.0~10.0 범위인가? → 아니면 수정.
6) 점수 분포가 너무 후하지 않은가? (기본 5~7점대, 특별히 잘한 부분만 8점 이상) → 아니면 수정.

- comment는 반드시 {{summary}}에 포함된 문구만 인용해야 한다.
- 존재하지 않는 사실(예: 토론, 질문, 감정 평가)은 절대 쓰지 않는다.
- summary에 단순 나열만 있을 경우, 그대로 인용하고 '설명이 부족하다'고 명시한다.

이제 위 규칙을 철저히 준수하여 JSON만 출력하라.
"""
